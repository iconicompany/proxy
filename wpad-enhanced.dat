function FindProxyForURL(url, host) {
    // QUICK DOMAIN MATCHES (string operations)
    if (
        shExpMatch(host, "(*.|)*.ru") ||
        shExpMatch(host, "(*.|)*.su") ||
        shExpMatch(host, "(*.|)*.xn--p1ai") ||
        shExpMatch(host, "(*.|)*.telegram.org") ||
        shExpMatch(host, "(*.|)*.live.com")
    ) {
        return "DIRECT";
    }
    if (
        shExpMatch(host, "(*.|)intema.ai") ||
        shExpMatch(host, "(*.|)beeai.dev") ||
        shExpMatch(host, "(*.|)authjs.dev") ||
        shExpMatch(host, "(*.|)addy.ie") ||
        shExpMatch(host, "(*.|)gitingest.com") ||
        shExpMatch(host, "(*.|)huggingface.co") ||
        shExpMatch(host, "(*.|)cheatingdaddy.com") ||
        shExpMatch(host, "(*.|)manus.im") ||
        shExpMatch(host, "(*.|)heygen.com") ||
        shExpMatch(host, "(*.|)mermaidchart.com") ||
        shExpMatch(host, "(*.|)claude.com") ||
        shExpMatch(host, "(*.|)notion.*") ||
        shExpMatch(host, "(*.|)fireworks.ai") ||
        shExpMatch(host, "(*.|)litellm.ai") ||
        shExpMatch(host, "(*.|)oxc.rs") ||
        shExpMatch(host, "(*.|)openevidence.com") ||
        shExpMatch(host, "(*.|)oaistatic.com") ||
        shExpMatch(host, "(*.|)chatgpt.com") ||
        shExpMatch(host, "(*.|)openai.com") ||
        shExpMatch(host, "(*.|)openlume.com") ||
        shExpMatch(host, "(*.|)clickup.com") ||
        shExpMatch(host, "(*.|)myip.com") ||
        shExpMatch(host, "(*.|)canva.com") ||
        shExpMatch(host, "(*.|)gstatic.com") ||
        shExpMatch(host, "(*.|)googleadservices.com") ||
        shExpMatch(host, "(*.|)googleapis.com") ||
        shExpMatch(host, "(*.|)google.*") ||
        shExpMatch(host, "(*.|)googlevideo.com") ||
        shExpMatch(host, "(*.|)youtu.be") ||
        shExpMatch(host, "(*.|)youtube.*") ||
        shExpMatch(host, "(*.|)linkedin.com") ||
        shExpMatch(host, "(*.|)x.com") ||
        shExpMatch(host, "(*.|)twimg.com") ||
        shExpMatch(host, "(*.|)microsoft.com")
    ) {
        return "HTTPS proxy.iconicompany.com:3129";
    }

    var ip = dnsResolve(host);
    if (!ip || (ip.indexOf(".") === -1 && ip.indexOf(":" ) === -1)) {
        return "DIRECT";
    }

    // IPv4 DIRECT
    if (
        isInNet(ip, "5.0.0.0", "255.0.0.0") ||
        isInNet(ip, "10.0.0.0", "255.0.0.0") ||
        isInNet(ip, "31.128.0.0", "255.128.0.0") ||
        isInNet(ip, "37.0.0.0", "255.0.0.0") ||
        isInNet(ip, "46.0.0.0", "255.0.0.0") ||
        isInNet(ip, "77.0.0.0", "255.0.0.0") ||
        isInNet(ip, "78.0.0.0", "254.0.0.0") ||
        isInNet(ip, "80.0.0.0", "240.0.0.0") ||
        isInNet(ip, "172.16.0.0", "255.240.0.0") ||
        isInNet(ip, "176.0.0.0", "255.0.0.0") ||
        isInNet(ip, "178.0.0.0", "255.0.0.0") ||
        isInNet(ip, "185.0.0.0", "255.0.0.0") ||
        isInNet(ip, "188.0.0.0", "255.0.0.0") ||
        isInNet(ip, "192.168.0.0", "255.255.0.0") ||
        isInNet(ip, "212.0.0.0", "254.0.0.0") ||
        isInNet(ip, "217.0.0.0", "255.0.0.0")
    ) {
        return "DIRECT";
    }

    // IPv6 helpers
    function expandIPv6(ipv6) {
        if (ipv6.indexOf("::") !== -1) {
            const parts = ipv6.split("::");
            const left = parts[0] ? parts[0].split(":") : [];
            const right = parts[1] ? parts[1].split(":") : [];
            const fill = new Array(8 - left.length - right.length).fill("0");
            ipv6 = [...left, ...fill, ...right].join(":");
        }
        return ipv6;
    }
    function parseIPv6(ipv6) {
        try {
            const full = expandIPv6(ipv6).split(":");
            if (full.length !== 8) return false;
            let hex = "";
            for (let part of full) {
                hex += part.padStart(4, "0");
            }
            return BigInt("0x" + hex);
        } catch (e) { return false; }
    }
    function inIPv6Range(ipv6, low, high) {
        if (ipv6.indexOf(":") === -1) return false;
        const ip = parseIPv6(ipv6);
        const lo = parseIPv6(low);
        const hi = parseIPv6(high);
        if (ip === false || lo === false || hi === false) return false;
        return ip >= lo && ip <= hi;
    }

    // IPv6 DIRECT
    if (
false
    ) {
        return "DIRECT";
    }

    // IPv4 PROXY
    if (
        isInNet(ip, "3.10.0.0", "255.255.0.0") ||
        isInNet(ip, "3.11.0.0", "255.255.0.0") ||
        isInNet(ip, "3.29.0.0", "255.255.0.0") ||
        isInNet(ip, "3.35.0.0", "255.255.0.0") ||
        isInNet(ip, "3.101.0.0", "255.255.0.0") ||
        isInNet(ip, "3.107.0.0", "255.255.0.0") ||
        isInNet(ip, "3.128.0.0", "255.255.0.0") ||
        isInNet(ip, "3.134.0.0", "255.255.0.0") ||
        isInNet(ip, "3.146.0.0", "255.255.0.0") ||
        isInNet(ip, "3.147.0.0", "255.255.0.0") ||
        isInNet(ip, "3.160.0.0", "255.252.0.0") ||
        isInNet(ip, "3.164.0.0", "255.255.0.0") ||
        isInNet(ip, "3.165.0.0", "255.255.0.0") ||
        isInNet(ip, "3.166.0.0", "255.254.0.0") ||
        isInNet(ip, "3.168.0.0", "255.252.0.0") ||
        isInNet(ip, "3.172.0.0", "255.255.0.0") ||
        isInNet(ip, "3.173.0.0", "255.255.0.0") ||
        isInNet(ip, "3.174.0.0", "255.254.0.0") ||
        isInNet(ip, "3.231.0.0", "255.255.0.0") ||
        isInNet(ip, "3.234.0.0", "255.255.0.0") ||
        isInNet(ip, "3.236.0.0", "255.255.0.0") ||
        isInNet(ip, "13.32.0.0", "255.254.0.0") ||
        isInNet(ip, "13.35.0.0", "255.255.0.0") ||
        isInNet(ip, "13.54.0.0", "255.255.0.0") ||
        isInNet(ip, "13.59.0.0", "255.255.0.0") ||
        isInNet(ip, "13.113.0.0", "255.255.0.0") ||
        isInNet(ip, "13.124.0.0", "255.255.0.0") ||
        isInNet(ip, "13.134.0.0", "255.255.0.0") ||
        isInNet(ip, "13.203.0.0", "255.255.0.0") ||
        isInNet(ip, "13.210.0.0", "255.255.0.0") ||
        isInNet(ip, "13.224.0.0", "255.252.0.0") ||
        isInNet(ip, "13.228.0.0", "255.255.0.0") ||
        isInNet(ip, "13.233.0.0", "255.255.0.0") ||
        isInNet(ip, "13.248.0.0", "255.255.0.0") ||
        isInNet(ip, "13.249.0.0", "255.255.0.0") ||
        isInNet(ip, "15.158.0.0", "255.255.0.0") ||
        isInNet(ip, "15.188.0.0", "255.255.0.0") ||
        isInNet(ip, "15.207.0.0", "255.255.0.0") ||
        isInNet(ip, "18.64.0.0", "255.252.0.0") ||
        isInNet(ip, "18.68.0.0", "255.255.0.0") ||
        isInNet(ip, "18.154.0.0", "255.254.0.0") ||
        isInNet(ip, "18.160.0.0", "255.254.0.0") ||
        isInNet(ip, "18.164.0.0", "255.254.0.0") ||
        isInNet(ip, "18.172.0.0", "255.254.0.0") ||
        isInNet(ip, "18.175.0.0", "255.255.0.0") ||
        isInNet(ip, "18.192.0.0", "255.255.0.0") ||
        isInNet(ip, "18.199.0.0", "255.255.0.0") ||
        isInNet(ip, "18.200.0.0", "255.255.0.0") ||
        isInNet(ip, "18.216.0.0", "255.255.0.0") ||
        isInNet(ip, "18.229.0.0", "255.255.0.0") ||
        isInNet(ip, "18.230.0.0", "255.255.0.0") ||
        isInNet(ip, "18.238.0.0", "255.254.0.0") ||
        isInNet(ip, "18.244.0.0", "255.254.0.0") ||
        isInNet(ip, "23.91.0.0", "255.255.0.0") ||
        isInNet(ip, "23.228.0.0", "255.255.0.0") ||
        isInNet(ip, "24.110.0.0", "255.255.0.0") ||
        isInNet(ip, "34.195.0.0", "255.255.0.0") ||
        isInNet(ip, "34.216.0.0", "255.255.0.0") ||
        isInNet(ip, "34.223.0.0", "255.255.0.0") ||
        isInNet(ip, "34.226.0.0", "255.255.0.0") ||
        isInNet(ip, "35.93.0.0", "255.255.0.0") ||
        isInNet(ip, "35.158.0.0", "255.255.0.0") ||
        isInNet(ip, "35.162.0.0", "255.255.0.0") ||
        isInNet(ip, "35.167.0.0", "255.255.0.0") ||
        isInNet(ip, "36.103.0.0", "255.255.0.0") ||
        isInNet(ip, "43.218.0.0", "255.255.0.0") ||
        isInNet(ip, "44.220.0.0", "255.255.0.0") ||
        isInNet(ip, "44.222.0.0", "255.255.0.0") ||
        isInNet(ip, "44.227.0.0", "255.255.0.0") ||
        isInNet(ip, "44.234.0.0", "255.255.0.0") ||
        isInNet(ip, "47.129.0.0", "255.255.0.0") ||
        isInNet(ip, "51.44.0.0", "255.255.0.0") ||
        isInNet(ip, "52.15.0.0", "255.255.0.0") ||
        isInNet(ip, "52.46.0.0", "255.255.0.0") ||
        isInNet(ip, "52.47.0.0", "255.255.0.0") ||
        isInNet(ip, "52.52.0.0", "255.255.0.0") ||
        isInNet(ip, "52.56.0.0", "255.255.0.0") ||
        isInNet(ip, "52.57.0.0", "255.255.0.0") ||
        isInNet(ip, "52.66.0.0", "255.255.0.0") ||
        isInNet(ip, "52.78.0.0", "255.255.0.0") ||
        isInNet(ip, "52.82.0.0", "255.255.0.0") ||
        isInNet(ip, "52.84.0.0", "255.254.0.0") ||
        isInNet(ip, "52.124.0.0", "255.255.0.0") ||
        isInNet(ip, "52.199.0.0", "255.255.0.0") ||
        isInNet(ip, "52.212.0.0", "255.255.0.0") ||
        isInNet(ip, "52.220.0.0", "255.255.0.0") ||
        isInNet(ip, "52.222.0.0", "255.255.0.0") ||
        isInNet(ip, "54.182.0.0", "255.255.0.0") ||
        isInNet(ip, "54.192.0.0", "255.255.0.0") ||
        isInNet(ip, "54.230.0.0", "255.255.0.0") ||
        isInNet(ip, "54.233.0.0", "255.255.0.0") ||
        isInNet(ip, "54.239.0.0", "255.255.0.0") ||
        isInNet(ip, "54.240.0.0", "255.255.0.0") ||
        isInNet(ip, "56.125.0.0", "255.255.0.0") ||
        isInNet(ip, "57.182.0.0", "255.255.0.0") ||
        isInNet(ip, "57.183.0.0", "255.255.0.0") ||
        isInNet(ip, "58.254.0.0", "255.255.0.0") ||
        isInNet(ip, "64.252.0.0", "255.255.0.0") ||
        isInNet(ip, "65.8.0.0", "255.255.0.0") ||
        isInNet(ip, "65.9.0.0", "255.255.0.0") ||
        isInNet(ip, "70.132.0.0", "255.255.0.0") ||
        isInNet(ip, "71.152.0.0", "255.255.0.0") ||
        isInNet(ip, "76.76.0.0", "255.255.0.0") ||
        isInNet(ip, "76.223.0.0", "255.255.0.0") ||
        isInNet(ip, "99.79.0.0", "255.255.0.0") ||
        isInNet(ip, "99.84.0.0", "255.255.0.0") ||
        isInNet(ip, "99.86.0.0", "255.255.0.0") ||
        isInNet(ip, "103.21.0.0", "255.255.0.0") ||
        isInNet(ip, "103.22.0.0", "255.255.0.0") ||
        isInNet(ip, "103.31.0.0", "255.255.0.0") ||
        isInNet(ip, "104.16.0.0", "255.248.0.0") ||
        isInNet(ip, "104.24.0.0", "255.252.0.0") ||
        isInNet(ip, "108.138.0.0", "255.254.0.0") ||
        isInNet(ip, "108.156.0.0", "255.252.0.0") ||
        isInNet(ip, "108.162.0.0", "255.255.0.0") ||
        isInNet(ip, "111.13.0.0", "255.255.0.0") ||
        isInNet(ip, "116.129.0.0", "255.255.0.0") ||
        isInNet(ip, "118.193.0.0", "255.255.0.0") ||
        isInNet(ip, "119.147.0.0", "255.255.0.0") ||
        isInNet(ip, "120.52.0.0", "255.255.0.0") ||
        isInNet(ip, "120.232.0.0", "255.255.0.0") ||
        isInNet(ip, "120.253.0.0", "255.255.0.0") ||
        isInNet(ip, "130.176.0.0", "255.255.0.0") ||
        isInNet(ip, "131.0.0.0", "255.255.0.0") ||
        isInNet(ip, "141.101.0.0", "255.255.0.0") ||
        isInNet(ip, "143.204.0.0", "255.255.0.0") ||
        isInNet(ip, "144.220.0.0", "255.255.0.0") ||
        isInNet(ip, "162.158.0.0", "255.254.0.0") ||
        isInNet(ip, "172.64.0.0", "255.248.0.0") ||
        isInNet(ip, "173.245.0.0", "255.255.0.0") ||
        isInNet(ip, "180.163.0.0", "255.255.0.0") ||
        isInNet(ip, "188.114.0.0", "255.255.0.0") ||
        isInNet(ip, "190.93.0.0", "255.255.0.0") ||
        isInNet(ip, "197.234.0.0", "255.255.0.0") ||
        isInNet(ip, "198.41.0.0", "255.255.0.0") ||
        isInNet(ip, "204.246.0.0", "255.255.0.0") ||
        isInNet(ip, "205.251.0.0", "255.255.0.0") ||
        isInNet(ip, "216.137.0.0", "255.255.0.0")
    ) {
        return "HTTPS proxy.iconicompany.com:3129";
    }

    // IPv6 PROXY
    if (
        inIPv6Range(ip, "2400:7fc0:500::", "2400:7fc0:5ff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2400:cb00::", "2400:cb00:ffff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2404:c2c0:500::", "2404:c2c0:5ff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2405:8100::", "2405:8100:ffff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2405:b500::", "2405:b500:ffff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2409:8c00:2421:300::", "2409:8c00:2421:3ff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2409:8c00:2421:400::", "2409:8c00:2421:4ff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:ddd::", "2600:9000:ddd:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:eee::", "2600:9000:eee:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:fff::", "2600:9000:fff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:1000::", "2600:9000:1fff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:2000::", "2600:9000:2fff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:3000::", "2600:9000:3fff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:4000::", "2600:9000:4fff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:5200::", "2600:9000:52ff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:5308::", "2600:9000:530f:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:5310::", "2600:9000:531f:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:5320::", "2600:9000:533f:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:5340::", "2600:9000:537f:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:5380::", "2600:9000:53ff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:f000::", "2600:9000:f3ff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:f400::", "2600:9000:f4ff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:f500::", "2600:9000:f51f:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:f520::", "2600:9000:f52f:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:f534::", "2600:9000:f537:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:f538::", "2600:9000:f53f:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:f540::", "2600:9000:f57f:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:f580::", "2600:9000:f5ff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:f600::", "2600:9000:f7ff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2600:9000:f800::", "2600:9000:ffff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2606:4700::", "2606:4700:ffff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2803:f800::", "2803:f800:ffff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2a06:98c0::", "2a06:98c7:ffff:ffff:ffff:ffff:ffff:ffff") ||
        inIPv6Range(ip, "2c0f:f248::", "2c0f:f248:ffff:ffff:ffff:ffff:ffff:ffff")
    ) {
        return "HTTPS proxy.iconicompany.com:3129";
    }

    return "DIRECT";
}
